# üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API —Å–µ—Ä–≤–µ—Ä—É

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏. 
–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É —Å —Ä–µ–∞–ª—å–Ω—ã–º API —Å–µ—Ä–≤–µ—Ä–æ–º Cleverence Mobile SMARTS.

## –†–µ—à–µ–Ω–∏–µ

### 1. ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω—ã –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ò–∑–º–µ–Ω—ë–Ω —Ñ–∞–π–ª:** `src/App.tsx`

–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ `loadInitialData()`:

```typescript
function App() {
  // Initial data loading disabled - using API server data
  // To load mock data for development, uncomment:
  // useEffect(() => {
  //   import('./utils/loadInitialData').then(({ loadInitialData }) => {
  //     loadInitialData();
  //   });
  // }, []);
```

### 2. üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**Base URL –¥–ª—è API:** `http://localhost:9000/MobileSMARTS/api/v1/`

#### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `http://localhost:5173`
2. –í—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"
3. –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
4. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ" —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
5. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí"

### 3. üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —Å –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

```javascript
// –û—á–∏—Å—Ç–∏—Ç—å localStorage
localStorage.clear();

// –û—á–∏—Å—Ç–∏—Ç—å IndexedDB
indexedDB.deleteDatabase('warehouse-db');

// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
location.reload();
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Application tab –≤ DevTools

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Application ‚Üí Storage
3. Clear Storage ‚Üí Clear site data

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ (–≤ –∫–æ–¥–µ)

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å:

```javascript
// –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å resetData
import { resetData } from './utils/loadInitialData';

// –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
await resetData();

// –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
localStorage.clear();

// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
location.reload();
```

### 4. üì° –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ OData endpoints:

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
```
GET http://localhost:9000/MobileSMARTS/api/v1/DocTypes
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "value": [
    {
      "uni": "PrihodNaSklad",
      "name": "–ü—Ä–∏—Ö–æ–¥ –Ω–∞ —Å–∫–ª–∞–¥",
      "displayName": "–ü—Ä–∏—Ö–æ–¥ –Ω–∞ —Å–∫–ª–∞–¥",
      "buttonColor": "#daa420",
      ...
    }
  ]
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Ç–∏–ø—É:
```
GET http://localhost:9000/MobileSMARTS/api/v1/Docs/{DocType.uni}
```

–ü—Ä–∏–º–µ—Ä:
```
GET http://localhost:9000/MobileSMARTS/api/v1/Docs/PrihodNaSklad
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "value": [
    {
      "id": "DOC-001",
      "documentTypeName": "PrihodNaSklad",
      "name": "–ü—Ä–∏—Ö–æ–¥ ‚Ññ123",
      "createDate": "2025-10-31T10:00:00Z",
      "inProcess": true,
      "finished": false,
      ...
    }
  ]
}
```

### 5. üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `src/services/odataCache.ts`

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞:** –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –∫—ç—à–∞ (–µ—Å–ª–∏ –∫—ç—à —Å–≤–µ–∂–∏–π, < 5 –º–∏–Ω—É—Ç)
2. **–í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞:** –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
3. **–¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫—ç—à (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
4. **Fallback:** –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —Ä–∞–±–æ—Ç–∞—Ç—å offline –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

### 6. üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–§–∞–π–ª:** `src/services/api.ts`

API –∫–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –î–æ–±–∞–≤–ª—è–µ—Ç `Authorization: Bearer {token}` –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 401 Unauthorized
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Login –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 7. üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### OData Document Type:
```typescript
interface ODataDocumentType {
  uni: string;              // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞
  name: string;             // –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è
  displayName: string;      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
  buttonColor?: string;     // –¶–≤–µ—Ç –ø–ª–∏—Ç–∫–∏ (#hex)
  imageFileId?: string;     // ID –∏–∫–æ–Ω–∫–∏
}
```

#### OData Document:
```typescript
interface ODataDocument {
  id: string;                     // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  documentTypeName: string;       // –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ (uni)
  name: string;                   // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  description?: string;           // –û–ø–∏—Å–∞–Ω–∏–µ
  barcode?: string;               // –®—Ç—Ä–∏—Ö–∫–æ–¥
  createDate: string;             // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (ISO)
  lastChangeDate: string;         // –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è (ISO)
  userName?: string;              // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  warehouseId?: string;           // ID —Å–∫–ª–∞–¥–∞
  inProcess: boolean;             // –î–æ–∫—É–º–µ–Ω—Ç –≤ —Ä–∞–±–æ—Ç–µ?
  finished: boolean;              // –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω?
}
```

### 8. üêõ –û—Ç–ª–∞–¥–∫–∞

#### –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ:

- `‚úÖ` - –£—Å–ø–µ—à–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
- `üåê` - –ó–∞–ø—Ä–æ—Å –∫ API
- `‚ö†Ô∏è` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à)
- `‚ùå` - –û—à–∏–±–∫–∞

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
import { configService } from '@/services/configService';

console.log('Server URL:', configService.getServerUrl());
console.log('Is configured:', configService.isConfigured());
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à:

```javascript
import { odataCache } from '@/services/odataCache';

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
const stats = await odataCache.getCacheStats();
console.log('Cache stats:', stats);

// –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
await odataCache.clearCache();
```

### 9. üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `src/services/api.ts` | HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API |
| `src/services/odataCache.ts` | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ OData |
| `src/services/configService.ts` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π |
| `src/pages/Setup.tsx` | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ |
| `src/pages/Home.tsx` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤) |
| `src/pages/DocumentsByType.tsx` | –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Ç–∏–ø—É |
| `src/utils/loadInitialData.ts` | ‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ (–º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ) |

### 10. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:5173`
2. –ü—Ä–æ–π–¥–∏—Ç–µ Login (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
3. –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
4. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç–∏–ø ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
5. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
   ```
   ‚úÖ API baseURL updated: http://localhost:9000/MobileSMARTS/api/v1
   üåê Fetching DocTypes from API...
   ‚úÖ Fetched and cached 8 DocTypes from API
   ```

### 11. üö® Troubleshooting

#### –ü—Ä–æ–±–ª–µ–º–∞: "No DocTypes available"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ Setup
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ network tab –≤ DevTools

#### –ü—Ä–æ–±–ª–µ–º–∞: "401 Unauthorized"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ localStorage: `localStorage.getItem('auth_token')`

#### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ä—ã–µ –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω–∞:** IndexedDB –Ω–µ –æ—á–∏—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –û—á–∏—Å—Ç–∏—Ç—å IndexedDB
indexedDB.deleteDatabase('warehouse-db');
// –û—á–∏—Å—Ç–∏—Ç—å localStorage
localStorage.clear();
// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
location.reload();
```

#### –ü—Ä–æ–±–ª–µ–º–∞: CORS errors

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å localhost:5173

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ proxy –≤ vite.config.ts

### 12. üéØ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
- ‚úÖ –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º API
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è offline —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π baseURL –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

**–î–∞—Ç–∞:** 31 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ —Å API —Å–µ—Ä–≤–µ—Ä–æ–º

