# ðŸ“± ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð²

**Ð”Ð°Ñ‚Ð°:** 12 Ð½Ð¾ÑÐ±Ñ€Ñ 2025  
**Ð’ÐµÑ€ÑÐ¸Ñ:** 1.0.0

---

## ðŸ“‹ ÐžÐ±Ð·Ð¾Ñ€

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° "Ð¡ÐºÐ»Ð°Ð´-15" Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ **Ð´Ð²Ð° Ñ‚Ð¸Ð¿Ð° Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð²**:

1. **Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹** â€” Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ñ Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹
2. **ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹** â€” Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ñ‡ÐµÑ€ÐµÐ· QR-ÐºÐ¾Ð´ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ñ‚Ð¸Ð¿ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð¸ ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾.

---

## ðŸ” ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°

### ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

ÐŸÑ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚:

```typescript
{
  context: {
    interfaceType: 'standard' | 'custom',
    interfaceConfigId?: 'config-id',
    interfaceConfigVersion?: '1.0.0'
  }
}
```

**ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ñ‚Ð°Ðº:**

1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ ÑÑ…ÐµÐ¼Ñ‹ Ð² `localStorage` (`ui-schema-active` Ð¸Ð»Ð¸ `ui-schema-default`)
2. Ð•ÑÐ»Ð¸ ÑÑ…ÐµÐ¼Ð° Ð½Ð°Ð¹Ð´ÐµÐ½Ð° â†’ `interfaceType: 'custom'`
3. Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ `id` Ð¸ `version` Ð¸Ð· ÑÑ…ÐµÐ¼Ñ‹
4. Ð•ÑÐ»Ð¸ ÑÑ…ÐµÐ¼Ñ‹ Ð½ÐµÑ‚ â†’ `interfaceType: 'standard'`

---

## ðŸ“Š Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð´Ð»Ñ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð²

### 1. Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°

**Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ:** `custom_interface.loaded`

**ÐšÐ¾Ð³Ð´Ð°:** ÐŸÑ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÑÑ…ÐµÐ¼Ñ‹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° (Ð¸Ð· QR-ÐºÐ¾Ð´Ð°, localStorage Ð¸Ð»Ð¸ Ñ„Ð°Ð¹Ð»Ð°)

**Ð¡Ð²Ð¾Ð¹ÑÑ‚Ð²Ð°:**
```typescript
{
  schema_id: string;           // ID ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
  schema_version: string;      // Ð’ÐµÑ€ÑÐ¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
  buttons_count: number;       // ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ½Ð¾Ð¿Ð¾Ðº
  load_source: 'qr' | 'localStorage' | 'file'
}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```json
{
  "event": "custom_interface.loaded",
  "properties": {
    "schema_id": "warehouse-a-v2",
    "schema_version": "2.1.0",
    "buttons_count": 8,
    "load_source": "qr"
  },
  "context": {
    "interfaceType": "custom",
    "interfaceConfigId": "warehouse-a-v2",
    "interfaceConfigVersion": "2.1.0"
  }
}
```

### 2. ÐšÐ»Ð¸Ðº Ð¿Ð¾ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐµ

**Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ:** `custom_interface.button_click`

**ÐšÐ¾Ð³Ð´Ð°:** ÐŸÑ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Ð½Ð° Ð»ÑŽÐ±ÑƒÑŽ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð² ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð¼ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ

**Ð¡Ð²Ð¾Ð¹ÑÑ‚Ð²Ð°:**
```typescript
{
  button_label: string;        // Ð¢ÐµÐºÑÑ‚ ÐºÐ½Ð¾Ð¿ÐºÐ¸
  button_action: string;       // Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ (navigate, openDoc, etc.)
  button_params?: any;         // ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
  button_position?: {          // ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ Ð½Ð° ÑÐµÑ‚ÐºÐµ
    row: number;
    col: number;
  };
  button_color?: string;       // Ð¦Ð²ÐµÑ‚ ÐºÐ½Ð¾Ð¿ÐºÐ¸
}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```json
{
  "event": "custom_interface.button_click",
  "properties": {
    "button_label": "ÐŸÑ€Ð¸Ñ‘Ð¼ÐºÐ° A",
    "button_action": "navigate",
    "button_params": { "path": "/docs/PrihodNaSklad" },
    "button_position": { "row": 0, "col": 0 },
    "button_color": "#DAA420"
  },
  "context": {
    "interfaceType": "custom",
    "interfaceConfigId": "warehouse-a-v2"
  }
}
```

### 3. Ð¡ÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ QR-ÐºÐ¾Ð´Ð° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

**Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ:** `custom_interface.qr_scan`

**ÐšÐ¾Ð³Ð´Ð°:** ÐŸÑ€Ð¸ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ñ‡ÐµÑ€ÐµÐ· QR-ÐºÐ¾Ð´

**Ð¡Ð²Ð¾Ð¹ÑÑ‚Ð²Ð°:**
```typescript
{
  success: boolean;    // Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð»Ð¸ Ð½ÐµÑ‚
  error?: string;      // Ð¢ÐµÐºÑÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ (ÐµÑÐ»Ð¸ failed)
}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:**

```json
// Ð£ÑÐ¿ÐµÑˆÐ½Ð¾Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
{
  "event": "custom_interface.qr_scan",
  "properties": {
    "success": true
  }
}

// ÐÐµÑƒÐ´Ð°Ñ‡Ð½Ð¾Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
{
  "event": "custom_interface.qr_scan",
  "properties": {
    "success": false,
    "error": "Invalid schema format"
  }
}
```

---

## ðŸ“ˆ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°

### Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð² (ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ vs ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹)

```sql
-- Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ñƒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
SELECT 
  json_extract(context, '$.interfaceType') as interface_type,
  COUNT(*) as events,
  COUNT(DISTINCT user_id) as users,
  ROUND(100.0 * COUNT(*) / (SELECT COUNT(*) FROM events), 2) as percentage
FROM events
WHERE context IS NOT NULL
GROUP BY interface_type
ORDER BY events DESC;
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
| interface_type | events | users | percentage |
|----------------|--------|-------|------------|
| standard       | 8500   | 45    | 65.5       |
| custom         | 4500   | 25    | 34.5       |

---

### ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

```sql
-- ÐšÐ°ÐºÐ¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ñ‡Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾
SELECT 
  json_extract(context, '$.interfaceConfigId') as config_id,
  json_extract(context, '$.interfaceConfigVersion') as config_version,
  COUNT(*) as events,
  COUNT(DISTINCT user_id) as users,
  MIN(timestamp) as first_used,
  MAX(timestamp) as last_used
FROM events
WHERE json_extract(context, '$.interfaceType') = 'custom'
  AND json_extract(context, '$.interfaceConfigId') IS NOT NULL
GROUP BY config_id, config_version
ORDER BY events DESC;
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
| config_id | config_version | events | users | first_used | last_used |
|-----------|----------------|--------|-------|------------|-----------|
| warehouse-a-v2 | 2.1.0 | 3200 | 18 | 2025-11-01 | 2025-11-12 |
| warehouse-b-v1 | 1.5.0 | 900  | 6  | 2025-11-05 | 2025-11-12 |
| office-setup   | 1.0.0 | 400  | 1  | 2025-11-10 | 2025-11-12 |

---

### ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ð¾ÑÑ‚ÑŒ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð² ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°Ñ…

```sql
-- ÐšÐ°ÐºÐ¸Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÑŽÑ‚ÑÑ Ñ‡Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾
SELECT 
  json_extract(context, '$.interfaceConfigId') as config_id,
  json_extract(properties, '$.button_label') as button_label,
  json_extract(properties, '$.button_action') as button_action,
  COUNT(*) as clicks,
  COUNT(DISTINCT user_id) as users
FROM events
WHERE event_name = 'custom_interface.button_click'
GROUP BY config_id, button_label, button_action
ORDER BY clicks DESC
LIMIT 20;
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
| config_id | button_label | button_action | clicks | users |
|-----------|--------------|---------------|--------|-------|
| warehouse-a-v2 | ÐŸÑ€Ð¸Ñ‘Ð¼ÐºÐ° A | navigate | 850 | 15 |
| warehouse-a-v2 | ÐŸÐ¾Ð´Ð±Ð¾Ñ€ | navigate | 720 | 14 |
| warehouse-b-v1 | Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ | navigate | 340 | 5 |

---

### ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð½Ð° ÑÐµÑ‚ÐºÐµ (Ñ‚ÐµÐ¿Ð»Ð¾Ð²Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°)

```sql
-- ÐšÐ°ÐºÐ¸Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð½Ð° ÑÐµÑ‚ÐºÐµ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÑŽÑ‚ÑÑ Ñ‡Ð°Ñ‰Ðµ
SELECT 
  json_extract(properties, '$.button_position.row') as row,
  json_extract(properties, '$.button_position.col') as col,
  COUNT(*) as clicks,
  GROUP_CONCAT(DISTINCT json_extract(properties, '$.button_label')) as labels
FROM events
WHERE event_name = 'custom_interface.button_click'
  AND json_extract(context, '$.interfaceConfigId') = 'warehouse-a-v2'
GROUP BY row, col
ORDER BY row, col;
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ (Ñ‚ÐµÐ¿Ð»Ð¾Ð²Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°):**
| row | col | clicks | labels |
|-----|-----|--------|--------|
| 0   | 0   | 850    | ÐŸÑ€Ð¸Ñ‘Ð¼ÐºÐ° A |
| 0   | 1   | 720    | ÐŸÐ¾Ð´Ð±Ð¾Ñ€ |
| 1   | 0   | 450    | ÐžÑ‚Ð³Ñ€ÑƒÐ·ÐºÐ° |
| 1   | 1   | 380    | Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ |

---

### Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹

```sql
-- ÐšÐ°Ðº Ñ‡Ð°ÑÑ‚Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ Ð½Ð¾Ð²Ñ‹Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð¸ Ð¾Ñ‚ÐºÑƒÐ´Ð°
SELECT 
  json_extract(properties, '$.schema_id') as schema_id,
  json_extract(properties, '$.load_source') as load_source,
  COUNT(*) as loads,
  COUNT(DISTINCT user_id) as users,
  DATE(timestamp) as date
FROM events
WHERE event_name = 'custom_interface.loaded'
GROUP BY schema_id, load_source, date
ORDER BY date DESC, loads DESC;
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
| schema_id | load_source | loads | users | date |
|-----------|-------------|-------|-------|------|
| warehouse-a-v2 | qr | 15 | 15 | 2025-11-12 |
| warehouse-a-v2 | localStorage | 125 | 15 | 2025-11-12 |
| warehouse-b-v1 | qr | 5 | 5 | 2025-11-12 |

---

### Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ÑÑ‚ÑŒ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ QR-ÐºÐ¾Ð´Ð¾Ð²

```sql
-- Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ QR-ÐºÐ¾Ð´Ð¾Ð² ÑÐºÐ°Ð½Ð¸Ñ€ÑƒÐµÑ‚ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
SELECT 
  json_extract(properties, '$.success') as success,
  json_extract(properties, '$.error') as error,
  COUNT(*) as scans,
  COUNT(DISTINCT user_id) as users
FROM events
WHERE event_name = 'custom_interface.qr_scan'
GROUP BY success, error
ORDER BY scans DESC;
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
| success | error | scans | users |
|---------|-------|-------|-------|
| true    | null  | 45    | 25    |
| false   | Invalid schema | 8 | 6 |
| false   | Decompression error | 3 | 2 |

---

## ðŸ“Š ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹

### 1. ÐšÐ°ÐºÐ¾Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½ÐµÐµ?

**Ð’Ð¾Ð¿Ñ€Ð¾Ñ:** ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð¸Ð»Ð¸ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸?

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```sql
SELECT 
  json_extract(context, '$.interfaceType') as interface_type,
  AVG(json_extract(properties, '$.duration_seconds')) as avg_duration_seconds,
  COUNT(*) as completed_docs
FROM events
WHERE event_name = 'document.completed'
GROUP BY interface_type;
```

---

### 2. ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ ÑÐ¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð½Ð° ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹

**Ð’Ð¾Ð¿Ñ€Ð¾Ñ:** Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿ÐµÑ€ÐµÑˆÐ»Ð¸ ÑÐ¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ° Ð½Ð° ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹?

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```sql
SELECT 
  user_id,
  MIN(CASE WHEN json_extract(context, '$.interfaceType') = 'standard' THEN timestamp END) as first_standard,
  MIN(CASE WHEN json_extract(context, '$.interfaceType') = 'custom' THEN timestamp END) as first_custom
FROM events
GROUP BY user_id
HAVING first_standard IS NOT NULL AND first_custom IS NOT NULL
  AND first_custom > first_standard;
```

---

### 3. ÐšÐ°ÐºÐ¸Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ?

**Ð’Ð¾Ð¿Ñ€Ð¾Ñ:** Ð•ÑÑ‚ÑŒ Ð»Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð² ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð¼ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ, Ð½Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð½Ð¸ÐºÑ‚Ð¾ Ð½Ðµ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÐµÑ‚?

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```sql
-- Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð²ÑÐµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¸Ð· ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ loaded
WITH loaded_buttons AS (
  SELECT 
    json_extract(properties, '$.schema_id') as schema_id,
    json_extract(properties, '$.buttons_count') as total_buttons
  FROM events
  WHERE event_name = 'custom_interface.loaded'
  ORDER BY timestamp DESC
  LIMIT 1
),
clicked_buttons AS (
  SELECT 
    COUNT(DISTINCT json_extract(properties, '$.button_label')) as used_buttons
  FROM events
  WHERE event_name = 'custom_interface.button_click'
)
SELECT 
  l.total_buttons,
  c.used_buttons,
  l.total_buttons - c.used_buttons as unused_buttons
FROM loaded_buttons l, clicked_buttons c;
```

---

### 4. ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹

**Ð’Ð¾Ð¿Ñ€Ð¾Ñ:** ÐšÐ°ÐºÐ¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ñ‡Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ°ÑŽÑ‚ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ QR-ÐºÐ¾Ð´Ð¾Ð²?

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```sql
SELECT 
  json_extract(properties, '$.error') as error_message,
  COUNT(*) as occurrences,
  COUNT(DISTINCT user_id) as affected_users
FROM events
WHERE event_name = 'custom_interface.qr_scan'
  AND json_extract(properties, '$.success') = 'false'
GROUP BY error_message
ORDER BY occurrences DESC;
```

---

## ðŸŽ¯ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ñƒ

### 1. Ð’ÑÐµÐ³Ð´Ð° Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ñƒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°

ÐŸÑ€Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ñ‚Ð¸Ð¿ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°:

```sql
WHERE json_extract(context, '$.interfaceType') = 'custom'
```

### 2. Ð“Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

Ð Ð°Ð·Ð½Ñ‹Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ â€” Ñ€Ð°Ð·Ð½Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ:

```sql
GROUP BY json_extract(context, '$.interfaceConfigId')
```

### 3. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹

ÐÐ¾Ð²Ñ‹Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ UX:

```sql
GROUP BY 
  json_extract(context, '$.interfaceConfigId'),
  json_extract(context, '$.interfaceConfigVersion')
```

### 4. ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹

Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ, ÐºÐ°Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ÑÑ Ð¼ÐµÐ¶Ð´Ñƒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°Ð¼Ð¸:

```sql
SELECT 
  user_id,
  event_name,
  json_extract(context, '$.interfaceType') as interface_type,
  timestamp
FROM events
WHERE user_id = 'specific-user-id'
ORDER BY timestamp;
```

---

## ðŸ’¡ Ð¢Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¸Ð½ÑÐ°Ð¹Ñ‚Ñ‹

### Ð˜Ð½ÑÐ°Ð¹Ñ‚ 1: ÐÐ´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ñ Ðº ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð¼Ñƒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ

**ÐÐ°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ:** ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸, Ð¿ÐµÑ€ÐµÑˆÐµÐ´ÑˆÐ¸Ðµ Ð½Ð° ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ, Ð¿ÐµÑ€Ð²Ñ‹Ðµ 2 Ð´Ð½Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½ÐµÐµ, Ð¿Ð¾Ñ‚Ð¾Ð¼ â€” Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾.

**Ð’Ñ‹Ð²Ð¾Ð´:** ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½ÐµÐµ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° Ð°Ð´Ð°Ð¿Ñ‚Ð°Ñ†Ð¸Ð¸.

---

### Ð˜Ð½ÑÐ°Ð¹Ñ‚ 2: ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð²Ð°Ð¶Ð½Ð°

**ÐÐ°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ:** ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð² Ð»ÐµÐ²Ð¾Ð¼ Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ ÑƒÐ³Ð»Ñƒ (row: 0, col: 0) Ð½Ð°Ð¶Ð¸Ð¼Ð°ÑŽÑ‚ÑÑ Ð½Ð° 40% Ñ‡Ð°Ñ‰Ðµ.

**Ð’Ñ‹Ð²Ð¾Ð´:** Ð Ð°Ð·Ð¼ÐµÑ‰Ð°Ð¹Ñ‚Ðµ ÑÐ°Ð¼Ñ‹Ðµ Ð²Ð°Ð¶Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð² Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ Ð»ÐµÐ²Ð¾Ð¼ ÑƒÐ³Ð»Ñƒ.

---

### Ð˜Ð½ÑÐ°Ð¹Ñ‚ 3: Ð¡Ð»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸

**ÐÐ°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ:** ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ >10 ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸ Ð¸Ð¼ÐµÑŽÑ‚ Ð½Ð° 25% Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¾ÑˆÐ¸Ð±Ð¾Ðº ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.

**Ð’Ñ‹Ð²Ð¾Ð´:** Ð£Ð¿Ñ€Ð¾Ñ‰Ð°Ð¹Ñ‚Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ, Ð½Ðµ Ð¿ÐµÑ€ÐµÐ³Ñ€ÑƒÐ¶Ð°Ð¹Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸.

---

### Ð˜Ð½ÑÐ°Ð¹Ñ‚ 4: QR-ÐºÐ¾Ð´Ñ‹ vs localStorage

**ÐÐ°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ:** 80% Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¾Ðº Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€Ð²Ð¾Ð¹ â€” Ð¸Ð· localStorage, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 20% â€” Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ QR.

**Ð’Ñ‹Ð²Ð¾Ð´:** ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ñ€ÐµÐ´ÐºÐ¾ Ð¼ÐµÐ½ÑÑŽÑ‚ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ, ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐ¹Ñ‚Ðµ Ð² localStorage.

---

## ðŸ”— Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸

### Ð¡Ð²ÑÐ·ÑŒ Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸

```sql
-- ÐšÐ°ÐºÐ¸Ðµ Ñ‚Ð¸Ð¿Ñ‹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð¸Ð· ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
SELECT 
  json_extract(e1.context, '$.interfaceConfigId') as config_id,
  json_extract(e2.properties, '$.document_type') as doc_type,
  COUNT(*) as opens
FROM events e1
JOIN events e2 ON e2.user_id = e1.user_id 
  AND e2.timestamp > e1.timestamp
  AND e2.timestamp < datetime(e1.timestamp, '+5 seconds')
WHERE e1.event_name = 'custom_interface.button_click'
  AND e2.event_name = 'document.opened'
GROUP BY config_id, doc_type
ORDER BY opens DESC;
```

---

## ðŸ“– Ð¡Ð¼. Ñ‚Ð°ÐºÐ¶Ðµ

- **[ANALYTICS.md](ANALYTICS.md)** â€” ÐŸÐ¾Ð»Ð½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐµ
- **[ANALYTICS_QUICK_START.md](ANALYTICS_QUICK_START.md)** â€” Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚
- **[server/queries.sql](../server/queries.sql)** â€” Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ðµ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹

---

**Ð’ÐµÑ€ÑÐ¸Ñ:** 1.0.0  
**Ð”Ð°Ñ‚Ð°:** 12 Ð½Ð¾ÑÐ±Ñ€Ñ 2025  
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾


