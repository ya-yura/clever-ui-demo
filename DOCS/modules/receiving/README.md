# üì¶ –ú–æ–¥—É–ª—å –ü—Ä–∏—ë–º–∫–∏ (Receiving)

## –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å –ø—Ä–∏—ë–º–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç–∞–≤–æ–∫ –ø–ª–∞–Ω–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º.

## –û–ø–µ—Ä–∞—Ü–∏–∏

### 1. –†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

#### –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏—ë–º–∫–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É, –ø–æ—Å—Ç–∞–≤—â–∏–∫—É, –¥–∞—Ç–µ
- –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –ø–æ—Å—Ç–∞–≤—â–∏–∫—É, –Ω–æ–º–µ—Ä—É –ø–æ—Å—Ç–∞–≤–∫–∏
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ, –ø–æ—Å—Ç–∞–≤—â–∏–∫—É, —Å—Ç–∞—Ç—É—Å—É, –Ω–æ–º–µ—Ä—É

#### –°—Ç–∞—Ç—É—Å—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `pending` - –û–∂–∏–¥–∞–µ—Ç (–Ω–µ –Ω–∞—á–∞—Ç)
- `in_progress` - –í —Ä–∞–±–æ—Ç–µ (—á–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω)
- `completed` - –ó–∞–≤–µ—Ä—à—ë–Ω

### 2. –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏—ë–º–∫–∏ —Ç–æ–≤–∞—Ä–∞

#### –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ –∫–∞–º–µ—Ä—É
- –í–≤–æ–¥ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (—Å–∫–∞–Ω–µ—Ä –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞

#### –£—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- **–ê–≤—Ç–æ—É–≤–µ–ª–∏—á–µ–Ω–∏–µ**: +1 –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- **–ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏**: +1, +5, +10, -1
- **–†—É—á–Ω–æ–π –≤–≤–æ–¥**: —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- **–ü–æ –ø–ª–∞–Ω—É**: –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º

#### –°–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–æ–∫
- üü¢ **–ù–µ –Ω–∞—á–∞—Ç–æ** (pending): `fact = 0` - —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
- üîµ **–í —Ä–∞–±–æ—Ç–µ** (partial): `0 < fact < plan` - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- üü° **–ü–µ—Ä–µ–±–æ—Ä** (over-plan): `fact > plan` - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚ö´ **–ì–æ—Ç–æ–≤–æ** (completed): `fact = plan` - –∑–∞–≤–µ—Ä—à–µ–Ω–æ

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π

#### –ù–µ–¥–æ—Å—Ç–∞—á–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å –Ω–µ–¥–æ—Å—Ç–∞—á–µ–π

#### –ò–∑–ª–∏—à–∫–∏
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏—ë–º–∫–∏ —Å–≤–µ—Ä—Ö –ø–ª–∞–Ω–∞
- –û—Ç–º–µ—Ç–∫–∞ –≤ –∏—Ç–æ–≥–æ–≤–æ–º –æ—Ç—á—ë—Ç–µ

#### –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫ –ª–∏—à–Ω–∏–π (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

### 4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ `fact >= plan`
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é

#### –†—É—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç"
- –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å–≤–æ–¥–∫–∏:
  - –ü—Ä–∏–Ω—è—Ç–æ —Ç–æ—á–Ω–æ
  - –ù–µ–¥–æ—Å—Ç–∞—á–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π –∏ —à—Ç—É–∫)
  - –ò–∑–ª–∏—à–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π –∏ —à—Ç—É–∫)
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è–º–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/modules/receiving/
‚îú‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ api.ts            # API-—Å–ª–æ–π (demo/real)
‚îú‚îÄ‚îÄ logic.ts          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ components/       # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–±—É–¥—É—â–µ–µ)
```

### API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```typescript
class ReceivingAPI {
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
  getDocuments(filters?, sort?): Promise<ReceivingDocument[]>
  
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  getDocument(id): Promise<ReceivingDocument | null>
  
  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  getLines(documentId): Promise<ReceivingLine[]>
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
  updateLineQuantity(lineId, quantity): Promise<void>
  
  // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  completeDocument(documentId): Promise<void>
}
```

### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

```typescript
// –†–∞—Å—á—ë—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
calculateProgress(doc): number

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π
hasDiscrepancy(line): boolean
getDiscrepancyType(line): 'shortage' | 'surplus' | 'exact'

// –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è
getLinePriority(line): number
sortLinesByPriority(lines): ReceivingLine[]

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
getDocumentStats(lines): DocumentStats

// –í–∞–ª–∏–¥–∞—Ü–∏—è
canCompleteDocument(lines): { canComplete, warnings }
```

## –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

```mermaid
graph TD
    A[–í—ã–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞] --> B[–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞]
    B --> C{–¢–æ–≤–∞—Ä –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ?}
    C -->|–î–∞| D[–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞]
    C -->|–ù–µ—Ç| E[–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ]
    D --> F{–í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã?}
    F -->|–î–∞| G[–ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ]
    F -->|–ù–µ—Ç| B
    E --> B
    G --> H[–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é]
```

## –î–∞–Ω–Ω—ã–µ

### ReceivingDocument

```typescript
{
  id: string;
  number?: string;
  status: 'pending' | 'in_progress' | 'completed';
  supplier?: string;
  deliveryNumber?: string;
  expectedDate?: number;
  createdAt: number;
  updatedAt: number;
  totalLines: number;
  completedLines: number;
}
```

### ReceivingLine

```typescript
{
  id: string;
  documentId: string;
  productId: string;
  productName: string;
  productSku?: string;
  barcode?: string;
  quantityPlan: number;
  quantityFact: number;
  status: 'pending' | 'partial' | 'completed' | 'error';
  expiryDate?: number;
  lotNumber?: string;
  receivedAt?: number;
}
```

## Offline-—Ä–µ–∂–∏–º

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ IndexedDB
- –û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏—ë–º–∫–∏ —Ç–æ–≤–∞—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫:
- **–†–∞–∑–º–µ—â–µ–Ω–∏—é** (Placement) - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ —è—á–µ–π–∫–∞—Ö —Ö—Ä–∞–Ω–µ–Ω–∏—è
- **–ü–æ–¥–±–æ—Ä—É** (Picking) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–∫–∞–∑–∞—Ö
